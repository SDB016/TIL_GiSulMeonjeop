# JWT 

JWTλ” ν•λ‚μ μΈν„°λ„· ν‘μ¤€ μΈμ¦ λ°©μ‹μΌλ΅ μΈμ¦μ— ν•„μ”ν• μ •λ³΄λ“¤μ„ Tokenμ— λ‹΄μ•„ μ•”νΈν™”μ‹ν‚¨λ‹¤.      
Cookieμ™€ ν¬κ²“ λ‹¤λ¥΄μ§€λ” μ•μ§€λ§, κ°•μ΅°λλ” μ μ€ **μ„λ…λ ν† ν°**μ΄λΌλ” κ²ƒμ΄λ‹¤.     
              
κ³µκ°/κ°μΈ ν‚¤λ¥Ό μμΌλ΅ μ‚¬μ©ν•μ—¬ μ„λ…ν•  κ²½μ°             
κ°μΈ ν‚¤λ¥Ό λ³΄μ ν• μ„λ²„κ°€ μ΄ μ„λ…λ ν† ν°μ΄ μ •μƒμ μΈ ν† ν°μΈμ§€ μΈμ¦ν•  μ μλ‹¤λ” κ²ƒμ΄λ‹¤.        
μ΄λ¬ν• JWTμ κµ¬μ΅° λ•λ¬Έμ— μΈμ¦ μ •λ³΄λ¥Ό λ‹΄μ•„ μ•μ „ν•κ² μΈμ¦μ„ μ‹λ„ν•κ²λ” μ „λ‹¬ν•  μ μλ” κ²ƒμ΄λ‹¤.      
  
**κµ¬μ„±μ”μ†**  
* Header : ν† ν° νƒ€μ…, μ„λ… μƒμ„± μ•κ³ λ¦¬μ¦ 
* Payload : μ‹¤μ  λ°μ΄ν„° λ³Έλ¬Έ 
* Signature : 

## Header   

```json
{
  "typ": "JWT",
  "alg": "HS512"
}
```  
headerμ—λ” λ³΄ν†µ ν† ν°μ νƒ€μ…μ΄λ‚, μ„λ… μƒμ„±μ— μ–΄λ–¤ μ•κ³ λ¦¬μ¦μ΄ μ‚¬μ©λμ—λ”μ§€ μ €μ¥ν•λ‹¤.     

## Payload  

```json
{
  "sub": "1",
  "iss": "ori",
  "exp": 1636989718,
  "iat": 1636987918
}
```
playload μ€ λ³΄ν†µ Claim μ΄λΌλ” μ‚¬μ©μ/ν† ν°μ— λ€ν• ν”„λ΅νΌν‹°λ¥Ό Key-Value ν•νƒλ΅ μ €μ¥ν•λ‹¤.   
Claimμ΄λΌλ” λ§ κ·Έλ€λ΅ ν† ν°μ—μ„ μ‚¬μ©ν•  μ •λ³΄μ μ΅°κ°μ„ μλ―Έν•λ‹¤.     
  
**JWT ν‘μ¤€ Claim μ¤ν™**     *
1. iss(Issure): ν† ν° λ°κΈ‰μ 
2. sub(Subject): ν† ν° μ λ©(μ‚¬μ©μμ— λ€ν• μ‹λ³„κ°’)    
3. aud(Audience): ν† ν° λ€μƒμ  
4. exp(Expiration Time): ν† ν° λ§λ£ μ‹κ°„  
5. iat(Issued At): ν† ν° λ°κΈ‰ μ‹κ°„
6. nbf(Not Before): ν† ν° ν™μ„± λ‚ μ§(μ΄ λ‚ μ§ μ΄μ „μ ν† ν°μ€ ν™μ„±ν™” λμ§€ μ•μμ„ λ³΄μ¥)   
7. jti(JWT id): JWT ν† ν° μ‹λ³„μ(Issureκ°€ μ—¬λΏμΌ κ²½μ° μ‚¬μ©ν•λ‹¤)   

JWT ν‘μ¤€ Claim μ¤ν™μ€ λ‹¨μν μ¤ν™μΌ λΏμ΄μ§€ κΌ­ μ΄ 7κ°€μ§€λ§ μ‚¬μ©ν•΄μ•Όν•λ” λ²•μ€ μ—†λ‹¤.    
μƒν™©μ— λ”°λΌ μ‚¬μ©ν•κ³  ν•„μ”μ‹ μ‚¬μ©μκ°€ μ»¤μ¤ν…€ν•κ² λ§λ“¤μ–΄ μ‚¬μ©ν•  μ μλ‹¤.    
        
**λ‹¨, μ¤‘μ”ν• κ²ƒμ€ payload μ—λ” λ―Όκ°ν• μ •λ³΄λ¥Ό λ‹΄μ§€ μ•μ•„μ•Όν•λ‹¤.**           
headerμ™€ payloadμ κ²½μ° base64λ΅ μΈμ½”λ”© λμ–΄μμ„ λΏμ΄μ§€ νΉλ³„ν• μ•”νΈν™”κ°€ κ±Έλ ¤μλ” κ²ƒμ΄ μ•„λ‹λ‹¤.            
λ„κµ¬λ‚ jwtλ¥Ό κ°€μ§€κ³  μλ‹¤λ©΄ base64 λ””μ½”λ”©μ„ ν†µν•΄ headerλ‚ payloadμ— λ‹΄κΈ΄ κ°’μ„ μ• μ μλ‹¤.        
κ·Έλ ‡κΈ° λ•λ¬Έμ— JWT Payloadλ” λ‹¨μν **μ‹λ³„ν•κΈ° μ„ν• μ •λ³΄**λ§μ„ λ‹΄μ•„λ‘λ”κ² μΆ‹λ‹¤.    
      
**κ·Έλ ‡λ‹¤λ©΄, Headerμ™€ Payloadμ—λ„ μ•”νΈν™”λ¥Ό ν•΄μ•Όν•μ§€ μ•λ‚? π¤”**         
* μ•„λ‹λ‹¤. λ§μ•½ κ·Έλ ‡κ² ν•λ‹¤λ©΄ λ§¤ μ”μ²­μ‹λ§λ‹¤ λ³µνΈν™”ν•λ” μ‘μ—…μ„ μ¶”κ°€λ΅ μ§„ν–‰ν•΄μ•Όν•λ‹¤.        
* κ·Έλ ‡κΈ° λ•λ¬Έμ— μ μ¶λμ—μ„ λ• κ·Έλ ‡κ² ν° μƒκ΄€μ΄ μ—†λ” λΉ„λ―Όκ° μ •λ³΄λ¥Ό ν† ν°μ— λ‹΄λ” κ²ƒμ΄ κΈ°λ³Έ μ¤ν™μ΄λ‹¤.  

## Signature
JWTμ—μ„ κ°€μ¥ μ¤‘μ”ν• μ”μ†μΈ μ„λ…μ΄λ‹¤.       

![α„ƒα…΅α„‹α…®α†«α„…α…©α„ƒα…³](https://user-images.githubusercontent.com/50267433/146970625-188ee54e-b235-4bd8-8960-61cb5e25da22.png)
  
μ„λ…μ€ μ„μ™€ κ°™μ΄ headerλ¥Ό λ””μ½”λ”©ν• κ°’, payloadλ¥Ό λ””μ½”λ”©ν• κ°’μ„ ν•©μΉκ³       
μ΄λ¥Ό `your-256-bit-secret` μ¦‰, μ„λ²„κ°€ κ°€μ§€κ³  μλ” κ°μΈν‚¤λ¥Ό κ°€μ§€κ³  μ•”νΈν™”λμ–΄μλ” μƒνƒλ‹¤.    
    
λ”°λΌμ„ signatureλ” μ„λ²„μ— μλ” κ°μΈν‚¤λ΅λ§ μ•”νΈν™”λ¥Ό ν’€ μ μκ³            
**λ‹¤λ¥Έ ν΄λΌμ΄μ–ΈνΈλ” μ„μλ΅ Signatureλ¥Ό λ³µνΈν™”ν•  μ μ—†λ‹¤.**         
  
1. JWT ν† ν°μ„ ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„λ΅ μ”μ²­κ³Ό λ™μ‹μ— μ „λ‹¬ν•λ‹¤.      
2. μ„λ²„κ°€ κ°€μ§€κ³ μλ” κ°μΈν‚¤λ¥Ό κ°€μ§€κ³  Signatureλ¥Ό λ³µνΈν™”ν•λ‹¤.     
3. base64UrlEncode(header)κ°€ JWTμ heaerκ°’κ³Ό μΌμΉν•μ§€ ν™•μΈν•λ‹¤     
4. base64UrlEncode(payload)κ°€ JWTμ payloadκ°’κ³Ό μΌμΉν•μ§€ ν™•μΈν•λ‹¤.  
5. λ¨λ“  λ°μ΄ν„°κ°€ μΌμΉν•  κ²½μ° μΈμ¦μ„ ν—μ©ν•λ‹¤.        
   
μ—¬κΈ°μ„ μ¤‘μ”ν• μ μ€ κ°μΈν‚¤λ¥Ό ν†µν•΄ λ³µνΈν™”λ¥Ό ν•λ” κ²ƒλΏλ§ μ•„λ‹λΌ κΈ°μ΅΄κ°’μ„ λΉ„κµν•λ‹¤λ” κ²ƒμ΄λ‹¤.   

* λ™μΌν• Header/PayloadλΌ ν• μ§€λΌλ„ κ³µκ°ν‚¤/κ°μΈν‚¤ μ΅°ν•©μ΄ λ‹¬λΌ λ³µνΈν™”κ°€ μ•λλ‹¤.    
* νƒμ·¨ν•΄μ„ Header/Payload κ°’μ„ λ°”κΏ€μ§€λΌλ„ λ³µν™”ν›„ λΉ„κµμ‘μ—…μ‹ κ°’μ΄ λ‹¬λΌ μ‹¤ν¨ν•λ‹¤.    
  
# JWT μ¥μ  
   
1. μ΄λ―Έ ν† ν° μμ²΄κ°€ μΈμ¦λ μ •λ³΄μ΄κΈ° λ•λ¬Έμ— μ„Έμ… μ €μ¥μ†μ™€ κ°™μ€ λ³„λ„μ μΈμ¦ μ €μ¥μ†κ°€ `ν•„μμ `μΌλ΅ ν•„μ”ν•μ§€ μ•λ”λ‹¤.
2. μ„Έμ…κ³Όλ” λ‹¤λ¥΄κ² ν΄λΌμ΄μ–ΈνΈμ μƒνƒλ¥Ό μ„λ²„κ°€ μ €μ¥ν•΄λ‘μ§€ μ•μ•„λ„ λλ‹¤.
3. signatureλ¥Ό κ³µν†µν‚¤ κ°μΈν‚¤ μ•”νΈν™”λ¥Ό ν†µν•΄ λ§‰μ•„λ‘μ—κΈ° λ•λ¬Έμ— λ°μ΄ν„°μ— λ€ν• λ³΄μ™„μ„±μ΄ λμ–΄λ‚λ‹¤.
4. λ‹¤λ¥Έ μ„λΉ„μ¤(μ›Ή/μ•±)μ— μ΄μ©ν•  μ μλ” κ³µν†µμ μΈ μ¤ν™μΌλ΅μ¨ μ‚¬μ©ν•  μ μλ‹¤.

# JWT λ‹¨μ (ν•κ³„)  
   
1. μΏ ν‚¤, μ„Έμ…λ•μ™€λ” λ‹¤λ¥΄κ² base64μΈμ½”λ”©μ„ ν†µν• μ •λ³΄λ¥Ό μ „λ‹¬ν•λ―€λ΅ μ „λ‹¬λ‰μ΄ λ§λ‹¤. 
   λ”°λΌμ„ λ„¤νΈμ›ν¬ μ „λ‹¬ μ‹ λ§μ€ λ°μ΄ν„°λ‰μΌλ΅ λ¶€ν•κ°€ μƒκΈΈ μ μλ‹¤.
2. Payloadμ—λ” μ•”νΈν™”κ°€ λμ–΄μμ§€ μ•κΈ° λ•λ¬Έμ— λ―Όκ° μ •λ³΄λ¥Ό μ €μ¥ν•  μ μ—†λ‹¤.
3. **ν† ν°μ΄ νƒμ·¨λ‹Ήν•λ©΄ λ§λ£λ  λ•κΉμ§€ λ€μ²κ°€ λ¶κ°€λ¥ν•λ‹¤**   
   
**ν•΄κ²° λ°©λ²•μ€? π¤”**     
JWTλ” ν΄λΌμ΄μ–ΈνΈκ°€ κ΄€λ¦¬ν•λ” μ”μ†λΌ μ„λ²„μ—μ„ ν¬κ² ν•΄κ²°ν•  μ μλ” μ”μ†κ°€ μ—†λ‹¤.     
λ€μ‹ , exp λ§λ£μ‹κ°„μ„ μ§§κ² κ°€μ Έκ°€λ” λ°©μ‹μΌλ΅ μµμ†ν•μ λ³΄μ•μ„±μ„ λ³΄μ¥ν•κ²λ” ν•λ‹¤.(30λ¶„~1μ‹κ°„)            
      
μ‹κ°„μ΄ μ§§μμΌλ΅μ„ μ μ €λ“¤μ΄ κ²λ” λ¶νΈν•¨μ΄ μ¦κ°€ν•  μ μλ”λ° μ΄λ¥Ό λ³΄μ•ν•΄μ¤„ 2κ°€μ§€κ°€ κΈ°λ¥μ΄ μλ‹¤.

1. Sliding Session 
2. Refresh Token 

## Sliding Session
νΉμ • μ„λΉ„μ¤λ¥Ό μ‚¬μ©ν•κ³  μλ” μ μ €μ— λ€ν•΄ λ§λ£ μ‹κ°„μ„ μ—°μ¥ μ‹μΌμ£Όλ” λ°©λ²•μ΄λ‹¤.       
`κΈ€μ“°κΈ°`, `κ²°μ ` λ“±κ³Ό κ°™μ€ νΉμ • actionμ„ μ μ €κ°€ ν–‰λ™ν•μ€μ„ λ•           
μƒλ΅­κ² λ§λ£μ‹κ°„μ„ λλ¦° JWTλ¥Ό λ‹¤μ‹ μ κ³µν•¨μΌλ΅μ¨ λ§λ£μ‹κ°„μ„ μ—°μ¥ν•μ—¬ λ³΄μ™„ν•λ” λ°©λ²•μ΄λ‹¤.      
  
## Refresh Token

JWTλ¥Ό μ²μ λ°κΈ‰ν•  λ•, Access Tokenκ³Ό ν•¨κ» **Refresh Tokenμ΄λΌλ” ν† ν°μ„ λ°κΈ‰ν•λ” λ°©λ²•μ΄λ‹¤.**    
μ΄λ¦„ κ·Έλ€λ΅ Access Tokenμ„ Refreshν•΄μ£Όλ” κ²ƒμ„ λ³΄μ¥ν•λ” ν† ν°μ΄λ©°       
Refresh Tokenμ€ μ§§μ€ μ‹κ°„μ΄ μ•„λ‹ λΉ„κµμ  κΈ΄μ‹κ°„ (7μΌ, 30μΌ λ“±)μ λ§λ£μ‹κ°„μ„ κ°€μ§„λ‹¤.    
   
ν΄λΌμ΄μ–ΈνΈκ°€ Access Tokenμ΄ λ§λ£λ¨μ„ λ³ΈμΈμ΄ μΈμ§€ν•κ±°λ‚, μ„λ²„λ΅λ¶€ν„° λ§λ£λ¨μ„ ν™•μΈλ°›μ•λ‹¤λ©΄      
Refresh TokenμΌλ΅ μ„λ²„μ—κ² μƒλ΅μ΄ Access Tokenμ„ λ°κΈ‰ν•λ„λ΅ μ”μ²­ν•μ—¬ λ°κΈ‰λ°›λ” λ°©μ‹μ΄λ‹¤.   

1. ν΄λΌμ΄μ–ΈνΈκ°€ ID, PWλ΅ μ„λ²„μ—κ² μΈμ¦μ„ μ”μ²­ν•κ³  μ„λ²„λ” μ΄λ¥Ό ν™•μΈν•μ—¬ Access Tokenκ³Ό Refresh Tokenμ„ λ°κΈ‰ν•λ‹¤.   
2. ν΄λΌμ΄μ–ΈνΈλ” μ΄λ¥Ό λ°›μ•„ Refresh Tokenλ¥Ό λ³ΈμΈμ΄ μ μ €μ¥ν•κ³  Access Tokenμ„ κ°€μ§€κ³  μ„λ²„μ— μμ λ΅­κ² μ”μ²­ν•λ‹¤.    
3. μ”μ²­μ„ ν•λ λ„μ¤‘ Access Tokenμ΄ λ§λ£λμ–΄ λ”μ΄μƒ μ‚¬μ©ν•  μ μ—†λ‹¤λ” μ¤λ¥λ¥Ό μ„λ²„λ΅λ¶€ν„° μ „λ‹¬ λ°›λ”λ‹¤.     
4. ν΄λΌμ΄μ–ΈνΈλ” λ³ΈμΈμ΄ μ‚¬μ©ν• Access Tokenμ΄ λ§λ£λμ—λ‹¤λ” μ‚¬μ‹¤μ„ μΈμ§€ν•κ³      
   λ³ΈμΈμ΄ κ°€μ§€κ³  μλ Refresh Tokenλ¥Ό μ„λ²„λ΅ μ „λ‹¬ν•μ—¬ μƒλ΅μ΄ Access Tokenμ λ°κΈ‰μ„ μ”μ²­ν•λ‹¤.     
5. μ„λ²„λ” Refresh Tokenμ„ λ°›μ•„ μ„λ²„μ Refresh Token Storageμ— ν•΄λ‹Ή ν† ν°μ΄ μλ”μ§€ ν™•μΈν•κ³ , μλ‹¤λ©΄ Access Tokenμ„ μƒμ„±ν•μ—¬ μ „λ‹¬ν•λ‹¤.  
        
**Refresh Token Storage :** μ„λ²„μ—μ„ Refresh Tokenμ„ μ €μ¥ν•λ” μ €μ¥μ†λ‹¤.(μ£Όλ΅ Redis)          
Refresh Tokenμ΄ μ„λ²„μ token μ €μ¥μ†μ— μλ”μ§€ ν™•μΈ ν›„ Access Tokenμ„ λ°κΈ‰ν•λ” ν•νƒμ΄λ‹¤.      

νΉμ • Storageμ— I/Oμ‘μ—…μ΄ λ°μƒν•κ² λλ©΄μ„ μ„Έμ…μ λ‹¨μ μ„ ν•λ‚ κ°€μ Έκ°€κ² λλ©΄μ„    
λ°λ€λ΅, ν† ν°μ΄ νƒμ·¨λμ—λ‹¤κ³  νλ‹¨λλ©΄ Refresh Token Storageλ¥Ό μ΄κΈ°ν™”ν•μ—¬       
νƒμ·¨λ ν† ν°μ΄ λ” Refresh λ»ν•λ„λ΅ λ§‰λ” λ“±κ³Ό κ°™μ€ λ¶€κ°€ μµμ…μ΄ μƒκΈ°κΈ°λ„ν•λ‹¤.    
  
μ°Έκ³ λ΅ μ„Έμ…μ€ μΈμ¦ μ”μ²­μ‹λ§λ‹¤ I/O μ‘μ—…μ„ ν•λ” λ°λ©΄μ—       
λ¦¬ν”„λ μ‹ ν† ν°μ€ κ°±μ‹  μ”μ²­λ•λ§ I/O μ‘μ—…μ„ μ§„ν–‰ν•λ‹¤.        
λ”λ¶μ–΄, λ¦¬ν”„λ μ‹ ν† ν°μ„ μ‚¬μ©ν–λ‹¤ν•΄μ„ Stateful ν•΄μ§€μ§€λ” μ•λ”λ‹¤.   

# μ°Έκ³  
* λ΄„κ³µλ¶€λ‹ λΈ”λ΅κ·Έ : https://jinyoungchoi95.tistory.com/39  
* μ΅°μ–Έ : RestAPI μ„λ²„λ” Statelessν•΄μ•Όν•λ‹¤.  
