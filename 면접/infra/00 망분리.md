# 망 분리  
                        
보안은 기본적으로 ‘철통방어’는 힘들다는 전제를 하고 있다.                          
대신 공격자를 최대한 귀찮게하고 공격자가 뚫어야할 장벽들의 수와 양을 늘리는 관점이다.           
                       
**Defense in depth**                  
* 단어 그대로 다층적인 layer 구조의 보안체계를 의미한다.                 
* 심층 방어, 즉 여러 겹의 복잡한 방어를 통해 최적화되고 강력한 보안체계를 구축하는 것      
* 즉, 공격자가 최종 목표까지 뚫고 들어오는 과정에서 다층적으로 장벽에 막히도록 하는 보안 체계에 대한 관점이다.               
* 보안 제어가 실패하거나 시스템 수명주기 동안 직원, 절차, 기술 및     
  물리적 보안 측면을 포괄할 수 있는 취약성이 악용될 경우 중복성을 제공하는 것이 목적         
      
## Bastion       
     
22번 포트의 경우 보안이 뚫린다면 서비스에 심각한 문제를 일으킬 수 있다.        
그렇다고 모든 서버들에 보안 수준을 높게 잡으면, Auto-Scaling 등 확장성을 고려한 구성과 배치된다.               
이 경우 관리 포인트가 늘어나기에 **일반적으로는 보안 설정을 일정 부분을 포기하는 결정을 하게 된다.**        

Bastion 이란, 성 외곽을 보호하기 위해 돌출된 부분으로 적으로부터 효과적으로 방어하기 위한 수단이다.  
즉, 22번 포트로 접근 가능한 서버를 Bastion Server로 한정 짓고 Bastion server 에서 다른 vpc 서버로 이동하는 방식을 사용한다면   
악성 루트킷, 랜섬웨어 등으로 피해를 보더라도 Bastion Server만 재구성하면 되므로, 서비스에 영향을 최소화할 수 있다.         
             
추가적으로, **서비스 정상 트래픽과 관리자용 트래픽을 구분할 수 있다는 이점이 있다.**                  
가령, **서비스가 DDos 공격을 받아 대역폭을 모두 차지하고 있다면**      
**일반적인 방법으로 서비스용 서버에 접속하기는 어렵기 때문에 별도의 경로를 확보해둘 필요가 있다.**        
            
* Bastion -> Public -> Private 이러한 방식을 3-Tier-Architecture 라고 부른다.      
    * VPC 내부에 개인 정보를 다루는 DB 서버 등을 위한 내부망, 
    * 사용자가 접근하는 웹서버를 위한 외부망
    * ADMIN이 접근하는 바스티온 서버     
    * Defense in depth 관점에 입각한 네트워크를 구성한다.     
  
## Public      
     
실제 애플리케이션이 존재하는 서버이다.         
인터넷과 연결되어야하며, 해당 서버의 IP를 기준으로 사용자에게 서비스를 제공해주어야 한다.           
        
보안 그룹으로는 HTTP/HTTPS 의 통신 + Bastion의 SSH 접속만을 허용하도록 설정한다.            
HTTP 또한 앞단에 NGINX를 두어 HTTPS로 리다이렉트 하는 형태로 보안을 높일 수 있다.     
      
AWS의 경우 IG와 RouterTable 을 이용하여 해당 서버가 존재하는 서브넷에 접근 가능하도록 한다.      
     
## Private 

실제 DB나 공개되어서는 안되는 데이터들이 존재하는 서버이다.(해커들의 탈취 목적 지점)           
인터넷과 연결되어서는 안되며, Bastion 서버의 SSH를 통해서만 접근이 가능하다.           
단, 서버 설정을 위해 인터넷이 필요한 경우가 있는데 이때는 NAT를 이용하면 된다.       
    
앞서 언급했듯이 일반적으로 인터넷이 연결되면 안되기에        
AWS의 경우 RouterTable 을 설정하더라도 IG를 연결하면 안된다.        

## 통신망   

* 망 : 
    * 노드들과 이들 노드들을 연결하는 링크들로 구성된 하나의 시스템    
    * 전자신호를 통해 통신하는 모든 기기가 서로 통신하기 위해 만든 하나의 망 
* 노드 : 
    * IP를 갖고 있으며 통신할 수 있는 대상(IP로 식별할 수 있는 대상)         
* 링크 :   
    * 물리적 회선, 노드와 노드를 연결해주는 인프라    

하나의 Subnet을 하나의 망이라고 칭할 수 있겠네요        
    
**AWS 망**
* Region : 
    * 국가 / 지역         
* Availability Zone : 데이터센터         
    * ap-northeast-2a          
    * ap-northeast-2b        
* VPC            
    * 하나의 Region에 종속        
    * 다수의 AZ 설정 가능            
    * VPC IP 대역 내에서 망 구성           

## 장비 

허브 : 전기 신호를 증폭 시켜서 전송거리를 연장시키고, 여러 대의 디바이스를 연결해준다. repeater 와 Flooding 기능을 수행한다. 구조적으로 데이터를 한 번에 하나만 전송할 수 있기 때문에 두 개 이상의 노드가 동일한 시점에 패킷을 보낼때 발생하게 되는 충돌(collision)의 영역인 collision domain 을 공유한다. 결론적으로 허브는 요즘 거의 안쓴다고 한다.

스위치 : 허브의 collision domain 문제를 개선한 장비. 자신에게 연결된 노드들의 MAC 주소 와 포트 정보들을 보관하고 있는 MAC Table 을 가지고 있다. MAC Table 에 정보가 있을때 Forwarding 이 발생하고 MAC Table 에 정보가 없으면 Flooding 이 발생한다. 일반적인 L2 스위치 기준으로 OSI 7 layer 에서 DATA layer 까지만 커버한다. 즉, Broadcast Domain 구분이 불가능하다.

라우터 : 스위치와 마찬가지로 자신에게 연결된 노드들의 MAC 주소 정보들을 보관하고 있는 MAC Table 을 가지고 있다. MAC Table 에 정보가 있을때 Forwarding 이 발생하고 MAC Table 에 정보가 없으면 스위치와 다르게 Drop 이 발생한다. Broadcast Domain 구분이 가능.
