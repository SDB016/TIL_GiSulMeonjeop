# VPC 

<img width="619" alt="b3c9ac82a4e94f2d95e1db822716408c" src="https://user-images.githubusercontent.com/50267433/147635585-c96df37a-4567-4f36-ab51-3b37814543c3.png">        

* 서브넷 : VPC에 설정한 **네트워크 대역을 더 세부적으로 나눈 네트워크**                
* 인터넷 게이트웨이 : **VPC의 리소스와 인터넷 간의 통신을 활성화하기 위해 VPC에 연결하는 게이트웨이**        
* 라우팅테이블 : **네트워크 트래픽을 전달할 위치를 결정하는 데 사용하는 라우팅이라는 이름의 규칙 집합**     
               
VPC는 하나의 거대한 가상 내부 네트워크를 의미한다.                  
외부에 공개된 네트워크가 아니라 사내망과 같이 내부에서 사용될 용도의 네트워크를 만들 수 있다.     
개발자는 CIDR 방식을 이용하여 가용할 네트워크의 범위를 지정할 수 있다.                   
      
## 서브넷 
   
![image](https://user-images.githubusercontent.com/50267433/147636205-5afaa1f9-289a-49b8-8646-3f5e5a150609.png)
   
서브넷이란 VPC에 설정한 네트워크 대역을 여러 네트워크로 나누는 행위를 의미한다.              
VPC와 마찬가지로 CIDR 방식을 따른다.                     
       
EC2 서버를 생성할 때 VPC와 이에 사용하고자 하는 서브넷을 설정하면 되고          
AZ는 달리 설정해서 가용성을 높이는 방법을 추천하고 있다.                
            
**AZ**         
* AWS에 존재하는 개념으로 Availability Zone(가용영역)의 줄임말이다.        
* 가용 영역별로 물리적으로 격리되어 있다.         
* 이러한 이점을 이용하면 장애 내성이 더 강화될 수 있다.       
    * 예를 들어 2개 이상의 서버를 이용하여 서비스를 운영할 경우        
    * 각각의 서버를 각기 다른 AZ에 위치시킨다면 하나가 문제가 생겨도   
      다른 하나는 격리되어 있기 때문에 확률적으로 서비스가 계속 유지될 가능성이 크고           
      이는 곧 서비스의 장애내성이 강화되었다는 의미도 되기 때문이다.      
* 하나의 AZ에 서브넷을 몰아넣으면 AZ가 고장났을때 모든 서브넷을 이용하지 못한다.     
* 반면에 각각의 서브넷의 AZ를 달리하면 어느 한 AZ가 고장나도 예비 서브넷으로 대체가능하다.   

**예시**  
- 대역 : 200.200.0.0/24   
    - kwj1270-public-a : 200.200.0.0/26
    - kwj1270-public-b : 200.200.0.64/26
    - kwj1270-internal-c : 200.200.0.128/27
    - kwj1270-management-d : 200.200.0.160/27
            
`xxx.xxx.xxx.xxx/?`은 비트에서 앞에 `?`자리는 Net ID(네트워크)나머지는 호스트 IP라고 알리는 것이다.      
`/26`을 기준으로 설명하자면 00000000.0000000.00000000.00은 NetID이다.        
나머지 000000은 호스트 IP로 크기가 64부터 127 인 경우에 사용하면 된다.   
          
64를 이미 할당했으므로, `200.200.0.64/26`로 나머지 할다을 이어서할 수 있다.                
128 이후 32비트만 할당하고자 한다면 `/27`로 32비트를 잡아서 할당하면 된다.          
만약 128 이후 `/25`를 할 경우, 한번에 128~256 비트를 잡는다는거랑 동일한 의미이다.         
       
즉, `1.1.1.0/24`로 설정하여 `1.1.1.0~1.1.1.255`에 해당 하는 256개의 ip를 CIDR표현식 한 줄로 설정한 것이다.       
       
## 인터넷 게이트웨이    

![image](https://user-images.githubusercontent.com/50267433/147636388-38c0814f-9f9d-4060-981d-93e31cf7a921.png)    
      
* VPC의 인스턴스와 인터넷 간에 통신할 수 있게 해주는 역할  
* 퍼블릭 IPv4 주소가 할당된 인스턴스에 대해 NAT(네트워크 주소 변환)를 수행      
  
## 라우팅 테이블    

![image](https://user-images.githubusercontent.com/50267433/147636589-39646a06-cce7-449d-8169-cdc89d926a93.png)
      
서브넷에 속한 EC2가 외부와 통신을 하기 위해서는     
자신의 라우팅 테이블에 설정된 정보를 제외한 모든 대역(0.0.0.0/0)에 대한 통신을 Internet Gateway로 요청하게끔 설정해두어야 한다.       
라우팅 테이블을 생성하고 0.0.0.0/0 대역을 앞에서 생성한 Internet Gateway로 매핑하자.   

![image](https://user-images.githubusercontent.com/50267433/147636641-6182e4aa-b799-4d95-9988-dc3cab46e962.png)
   
이후, 서브넷 탭으로 들어가서 각각의 서브넷들에 대한 연결을 해준다.   

## NAT
공유기와 비슷, public network가 일종의 공유기 역할
public network를 통해서 private network들이 인터넷을 사용하게끔 만든다.

단, NAT 를 사용할때 단점은 여러명이 동시에 인터넷을 접속하게 되므로
실제로 접속하는 호스트 숫자에 따라서 접속 속도가 느려질 수 있다.
다만 성능이 좋을수록 대역폭만 줄어들고 체감되는 속도 저하는 꽤 적은편.

# 정리  
  
완벽한 보안은 불가능하다.     
그렇기 때문에 최대한 해커가 접근을 힘들게 하는 것도 하나의 보안 방법이다.     
  
3 tier architecture를 적용함으로써 각각의 인스턴스마다 보안을 달리 가져갈 수 있고       
해커는 최종 목적지인 db서버(private network)에 접근하는데 어려움을 겪을 것이다.       
        
보안과 상관없지만, 서버 운영 및 가용성을 위해 VPC를 설정할 수 있다.        
VPC 에서 여러 az 기준으로 서브넷을 나누고 각각의 서브넷에 각각의 인스턴스를 만들어 보안 및 재난에 대응할 수 있다.       
인터넷 게이트웨이는 vpc와 인터넷이 연결되어 통신하는 역할을 맡는다.     
라우터는 인터넷의 정보를 필요한 서브넷에 연결하는 작업을 한다.        
라우터는 인터넷 게이트에이와 서브넷을 연결하기에 private는 ig를 연결하지 않는 형태로 해야한다.    
단, private 도 인터넷이 필요할때가 있는데 이때 nat를 도입한다.   

* internet gateway : 인터넷 - ig - vpc
* router table : ig - rt - subnet    



