# CSRF(Cross-Site Request Forgery)  
> 사이트 간 요청 위조
      
CSRF는 기본적으로 **권한을 탈취하는 해킹 기법이 아니다.**            
오히려, **권한이 있거나 없어도 되는 가정하에 특정 작업을 처리하도록 하는 기법이다.**      
         
1. 사용자는 특정 사이트로부터 로그인을 했다.          
2. 해커가 사용자에게 피싱기법을 이용하여 특정 URL을 클릭하도록 유도한다.            
3. 만약, 사용자가 해당 URL을 클릭하면 패스워드를 변경시키는 작업을 하도록한다.            
4. 이후, 해커는 변경된 패스워드를 통해서 특정 사이트로 로그인하고 정보를 탈취한다.    
     
즉, 공격자가 링크를 통해 사용자가 인식하지 못하는 작업이나 정보를 탈취하는 기법이다.          
  
## 해결법   

* Http Header 중 Referer 헤더를 체크하는 방식(단, 조작이 가능하다)   
* CSRF 방지 토큰 사용  

# 스프링 시큐리티의 CSRF 

스프링 시큐리티 또한, CSRF를 방지할 수 있는 기능들을 제공해주고 있다.   
  
## 동작    
  
**스프링 시큐리티는 `CsrfFilter`를 제공한다.**        

![image](https://user-images.githubusercontent.com/50267433/146870007-47b122f5-7cf6-4f44-a7df-31ab8c3b7d9e.png)
    
1. 사용자가 로그인과 같은 인증과정을 거치면, 스프링 시큐리티는 사용자에게 랜덤하게 생성된 토큰을 발급해준다.     
2. 사용자는 모든 요청에 해당 토큰을 HTTP 파라미터에 넣어야 한다.   
3. 만약, 토큰을 전달하지 못하게 된다면 접근 불가하다.                     
4. 또한, 요청시 전달되는 토큰값과 서버에 저장된 실제값을 비교하고 일치하지 않으면 실패 처리한다.     

## Rest api에서의 CSRF(disable 이유)    
  
Spring Security가 non-browser clients 만을 위한 서비스라면 csrf를 disable 하여도 좋다고 한다.(레퍼런스왈)   
         
RestAPI 로만 이루어진 서버라면, Stateless한 서버이기 때문에 별도의 인증 정보를 보관하지 않아야한다.                
이러한 특징을 더 살리기 위해서, OAuth2, jwt토큰과 같은 필요한 인증 정보를 포함시켜서 전송하는 방식을 권장하고 있다.            
즉, 매 파라미터에 CSRF 토큰을 전송하는 불편한 코드는 더이상상요하지 않아도 된다는 것이다.(어차피 헤더에 다른 토큰으로 인증처리함)         
