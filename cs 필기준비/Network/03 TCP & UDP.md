# 📚 들어가면서    

데이터를 전송할 때 아래와 같은 문제가 발생할 수 있다.  

1. 잘못된 수신지  
2. 네트워크 에러 
3. 패킷 손상 
     
이처럼 여러 이유들로 인하여 데이터가 목적지로 도착하지 못하는 경우가 있다.             
그리고 이들은 TCP/IP에서 네트워크 액세스 영역에서 해결해 줄 수 없는 부분이기도 하다.           
(전송중인 데이터가 손상되거나 분실되면 아무런 후속 작업을 해줄 수 없다)       
      
이러한 문제를 해결하기 위해, **데이터에 전송/수신 관련 패킷을 붙이고 관리하는 전송계층영역이 등장했다.**         
       
# 📕 전송 계층       
      
전송 계층은 **두 시스템 간에 신뢰성 있는 데이터를 전송하기 위해 존재한다.**          
**즉, 오류를 식별하는 기능을 통해 데이터 전송 실패 및 오류 발생시 재전송을 할 수 있다.**                   
더불어, **포트 통해 데이터를 알맞는 Application 으로 전달해주기도 한다.**       
 
1. 흐름제어 : 
    * 수신측에서 설정한 윈도우 크기 만큼 응답(ACK)없이 전송하여 흐름 조절
2. 혼잡제어 
    * 느린 출발
    * 혼잡 회피
    * 손실 복구
    * Fast Retransmission
    * Fast Recovery 
3. 오류제어 
    * 시퀀스넘버 기반
    * ACK로 수신 확인
    * 오류 발생 시 CRC이용, 송신측에 프레임 재전송 요청

## 📖 포트번호    
포트는 **TCP가 상위 계층으로 데이터를 전송하거나 상위 계층에서 TCP로 데이터를 전송할 때 상호간에 사용하는 데이터의 이동 통로를 말한다.**        
즉, 데이터를 전송할 때는, 수신 측의 IP 주소가 필요하지만, **어떤 애플리케이션이 사용되고 있는지 구분하려면 TCP는 포트 번호가 필요하다.**    
`TCP/IP 4Layer`에서는 상위 계층 프로토콜과 하위 계층 프로토콜이 같은 포트를 사용한다는 특징도 있다.   

# 📗 TCP
TCP는 **연결지향형 프로토콜로 신뢰성 있는 바이트 스트림 서비스를 제공한다.**       
  
* **연결 지향 :** 응용 프로그램이 데이터를 교환하기 전에 서로 TCP 연결을 확립해야한다.(양방향-이중)            
* **신뢰성 :** 데이터를 성공적으로 수신했거나 오류가 발생했음을 알려주는 것       
      
**상호간에 네트워크 연결 합의하에 데이터를 보내고 성공적으로 수신할 때까지 재전송한다.**          
  
## 📖 TCP 헤더      
       
![header-600x336](https://user-images.githubusercontent.com/50267433/146669497-6c2a79bd-7be8-4438-b78b-c1c49c584362.jpeg)   
         
TCP 헤더에는 데이터를 보조해주는 다양한 정보들이 있다.                 
특히 **발신지 포트**, **목적지 포트**, **코드 비트**가 중요한 요소들이다.        
        
|코드 비트|설명|      
|--------|----|  
|URG|긴급하게 처리할 데이터가 들어 있음|   
|URG|응답 확인 번호 사용|    
|PSH|TCP가 받은 데이터를 상위 계층에 전달|    
|RST|연결 재설정|    
|SYN|연결을 초기화하려고 순서 번호 동기화|     
|FIN|데이터 송신 종료|        
  

### 📄 TCP 3-way Handshake    
  
TCP 전송 프로토콜을 사용한다면, 실제 데이터를 전송하기 전에 노드간에 연결이 확립 되어있어야한다.      
즉, **정확한 전송을 보장하기 위해 상대방 컴퓨터와 사전에 세션을 수립하는 과정**이 필요한데 이것이 TCP 3-way Handshake 이다.  

1. 클라이언트는 서버에게 접속을 요청하는 SYN 패킷을 보낸다.
2. 서버는 SYN 요청을 받고, 요청을 수락한다는 ACK 와 SYN 플래그가 설정된 패킷을 보낸다.
3. 클라이언트는 서버에게 다시 ACK 을 보낸다.

    
### 📄 TCP 4-way Handshake    
TCP 4-Way handshake는 두 시스템(컴퓨터)간에 연결된 세션을 종료하기 위해 수행되는 절차이다.               
      
1. 클라이언트가 서버로 연결을 종료하겠다는 FIN 플래그를 전송한다.
2. 서버는 클라이언트에게 ACK 메시지를 보내고 자신의 남은 통신이 끝날때까지 기다린다.
3. 서버가 통신이 끝나면 클라이언트로 FIN을 보낸다.
4. 클라이언트는 확인했다는 의미로 서버에게 ACK을 보내면 연결이 종료가 완료된다.
     
**TIME_OUT**    
* 서버가 클라이언트에게 FIN을 보냈는데 기존에 보내줘야할 데이터가 FIN보다 늦게 도착할 수도 있다는 문제가 있다.           
* 아무런 조치를 취하지 않는다면 클라이언트는 FIN을 받아 소켓을 닫아버릴거고 더이상 데이터를 받을 수 없을 것이다.         
* 이를 해결하기 위해 클라이언틑 **TIME_OUT** 을 두어 일정시간 동안 서버로부터 아직 받지 못한 데이터를 받는다.       
   
# 📘 UDP
UDP는 **비연결 지향형 프로토콜로 패킷이나 흐름제어, 단편화 및 전송보장등의 기능을 제공하지 않는다**             
`출발 포트`, `목적지 포트`, `메시지`를 제외한 부가적인 데이터가 없기 때문에 TCP 보다 가볍고    
연결도 하지 않기에 데이터 전송이 비교적 빨라서 실시간 데이터 전송에 많이 사용된다.(스트리밍 서비스, 계속 데이터를 전송)     
    
UDP를 사용하는 대표적인 응용 계층 프로토콜은 DNS, DHCP, SNMP 등이 있다.       
    
## UDP 헤더 

UDP 헤더는 **출발/목적지 포트 및 메시지와 응답 메시지로 구성되며 주로 적은 양의 데이터 전송에 사용된다.**   
       
         
![upd header](https://user-images.githubusercontent.com/50267433/106352114-09d72800-6324-11eb-90fc-bd769db80f74.PNG)     
    
UDP는 비연결형 서비스이고 데이터 전송의 신뢰성을 확보할 수 없기 때문에,       
네트워크에서 사용하기에 부적절하다고 생각할 수도 있다.          
    
그러나, 신뢰성을 확보하기 위한 부가적인 정보가 필요없으므로      
**전송 데이터의 양이 적을 때 TCP보다 전송 속도가 더 빠르다.**        
또한 상위 계층에 신뢰성을 보장하는 프로토콜이 있거나 인터넷 방송의 멀티미디어 데이터 전송처럼      
**정확성보다는 전송 속도가 더 중요할 때 유용하다.**          

# 🤜🤛TCP와 UDP의 비교
**TCP**   
`TCP(Transmission Control Protocol, 전송제어 프로토콜)` :   
* **연결형 전송 프로토콜**로서 신뢰성 과 안정성을 보장해준다.     
* TCP 서비스는 송신자와 수신자 모두가 소켓이라고 부르는 종단점을 생성함으로써 이루어진다. -> 가상 회선      
* TCP 에서 연결 설정(connection establishment)는 `3-way handshake`를 통해 행해진다.     
     
모든 TCP 연결은 전이중(full-duplex), 점대점(point to point)방식이다.           
전송이 양방향으로 동시에 일어나며 각 연결이 정확히 2 개의 종단점을 가지고 있다.                  
    
TCP 는 멀티캐스팅이나 브로드캐스팅을 지원하지 않는다.         
    
**UDP**     
`UDP(User Datagram Protocol, 사용자 데이터그램 프로토콜)`       
* **비연결형 전송 프로토콜** 로서 속도가 빠르나 신뢰성과 안정성을 보장해주지는 않는다. (재전송 x)       
  
`UDP`를 사용한 것들에는 `DNS`가 있다.        
사전에 설정이 필요하지 않으며 그 후에 해제가 필요하지 않다.       

# UDP가 신뢰성이 없는 이유 

1. TCP와 달리 노드간에 연결을하지 않고 데이터를 보낸다.(대신, 그래서 빠름)      
2. TCP와 달리 UDP는 송신 순서와 수신 순서가 같지 않다.    
3. TCP와 달리 `오류제어`와 `흐름제어`가 거의 없다.          
     
그렇기에 UDP는 실시간 멀티미디어 정보를 처리할 때 좋고, 패킷 소실이 있어도 다음 패킷을 수신하는 실시간 처리에 적합하다.         
